{"version":3,"sources":["src/factory.js","src/read.js","src/write.js","src/read-deep.js","src/write-deep.js"],"names":["traps","target","factory","proxyRead","writeTraps","proxyReadDeep"],"mappings":"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","file":"index.js","sourcesContent":["/**\n\t@module proxyFactory\n*/\n/**\n\tgenerates trap handlers by merging properties from trapChain to trapChain[0]\n\tor if the trapchain[0] is not extensible to an empty object.\n\n\tcontext\n\t\ttraps\n\t\t\tdefault traps to push to trapChain\n\n\t@param target\n\t\ta spread or array of level objects\n\t@param trapChain\n\t\ta spread of traps objects\n\t\tif target is a spread this will be an empty array\n*/\n\nfunction createProxy(target, ...trapChain) {\n\tlet stack = target.stack;\n\n\tif(!stack) {\n\t\tstack = target;\n\t\ttarget = {};\n\n\t\tif(!Array.isArray(stack)) {\n\t\t\tstack = Array.from(arguments);\n\t\t\ttrapChain = [];\n\t\t}\n\n\t\ttarget.stack = stack;\n\t}\n\n\tObject.assign(target, this.target);\n\n\tif(this.traps) {\n\t\ttrapChain.push(...this.traps);\n\t}\n\n\tlet traps = (\n\t\tObject.isExtensible(trapChain[0])\n\t\t\t?trapChain.shift()\n\t\t\t:{}\n\t);\n\n\ttrapChain.forEach(function(levelTraps) {\n\t\tObject.getOwnPropertyNames(levelTraps).forEach(function(property) {\n\t\t\tif(!traps.hasOwnProperty(property)) {\n\t\t\t\tObject.defineProperty(traps, property, Object.getOwnPropertyDescriptor(levelTraps, property));\n\t\t\t}\n\t\t});\n\t});\n\n\treturn new Proxy(target, traps)\n}\n\n/**\n\tCreates factory for generation Proxies\n\n\t@param { String | String[] } trapChain\n\t@param { Object } [target = {}] can be used to extend the later proxy target\n*/\n\nfunction proxyFactory(trapChain, target = {}) {\n\tif(!Array.isArray(trapChain)) {\n\t\ttrapChain = [trapChain];\n\t}\n\n\tlet _traps = [];\n\n\ttrapChain.forEach(function(factory) {\n\t\tif(factory.target) {\n\t\t\tObject.assign(target, factory.target);\n\t\t}\n\t\tif(factory.traps) {\n\t\t\t_traps.push(...factory.traps);\n\t\t} else {\n\t\t\t_traps.push(factory);\n\t\t}\n\t});\n\n\tlet factory = createProxy.bind({\n\t\ttraps : _traps,\n\t\ttarget\n\t});\n\n\tfactory.target = target;\n\tfactory.traps = _traps;\n\n\treturn factory;\n}\n\nexport default proxyFactory;\n","import proxyFactory from './factory.js';\n\nconst traps = Object.freeze({\n\tset(target, property, value) {\n\t\treturn target.stack[0][property] = value;\n\t},\n\tget(target, property) {\n\t\tvar host = target.findHost(property);\n\n\t\tif(host) {\n\t\t\treturn host[property];\n\t\t}\n\t},\n\tgetOwnPropertyDescriptor(target, property, receiver) {\n\t\tvar host = target.findHost(property);\n\n\t\tif(host) {\n\t\t\tvar desc = Object.getOwnPropertyDescriptor(host, property);\n\n\t\t\tif(desc) {\n\t\t\t\treturn desc;\n\t\t\t}\n\n\t\t\tif(host = Object.getPrototypeOf(host)) {\n\t\t\t\treturn Object.getOwnPropertyDescriptor(host, property);\n\t\t\t}\n\t\t}\n\t},\n\townKeys(target) {\n\t\tlet set = new Set();\n\n\t\ttarget.stack.forEach(function(level) {\n\t\t\t\tReflect.ownKeys(level).forEach(set.add, set);\n\t\t});\n\n\t\treturn Array.from(set);\n\t},\n\thas(target, property) { return target.findHost(property); }\n});\n\nconst target = {\n\t/**\n\treturns the first object in stack that has the property\n\tif none matches and root is set the top of the stack will be returned\n\t*/\n\n\tfindHost(property, root) {\n\t\tlet host = this.stack.find(function(level) {\n\t\t\treturn property in level;\n\t\t});\n\n\t\tif(host) {\n\t\t\treturn host;\n\t\t}\n\n\t\tif(root === true) {\n\t\t\treturn this.stack[0];\n\t\t}\n\t}\n};\n\nconst factory = proxyFactory(traps, target);\n\nexport {\n\tfactory as default,\n\ttarget,\n\ttraps\n}\n","import proxyFactory from './factory.js';\nimport proxyRead from './read.js';\n\nconst traps = Object.freeze({\n\tset(target, property, value) {\n\t\treturn Reflect.set(target.findHost(property, true), property, value);\n\t},\n\tdefineProperty(target, property, descriptor) {\n\t\treturn Reflect.defineProperty(target.findHost(property, true), property, descriptor);\n\t},\n\tdeleteProperty(target, property) {\n\t\treturn Reflect.deleteProperty(target.findHost(property, true), property);\n\t}\n});\n\nconst factory = proxyFactory([traps, proxyRead]);\n\nexport {\n\tfactory as default,\n\ttraps\n};\n","import proxyFactory from './factory.js';\nimport proxyRead from './read.js';\n\nconst objectToString = Object.prototype.toString;\n\nconst traps = {\n\tget(target, property) {\n\t\tvar hosts = target.findAllHosts(property);\n\n\t\tswitch(hosts.length) {\n\t\t\tcase 0:\n\t\t\t\treturn undefined;\n\t\t\tcase 1:\n\t\t\t\treturn hosts[0][property];\n\t\t}\n\n\t\tlet stack = [];\n\n\t\tfor(let i = 0; i < hosts.length ; i++) {\n\t\t\tlet host = hosts[i];\n\t\t\tlet value = host[property];\n\n\t\t\tswitch(objectToString.call(value)) {\n\t\t\t\tcase \"[object Object]\":\n\t\t\t\tcase \"[object Array]\":\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tstack.push(value);\n\t\t}\n\n\t\treturn target.factory(stack);\n\t}\n};\n\nconst target = {\n\t/**\n\t\treturns all objects in stack that have the property\n\t\tif none matches and root is set the top of the stack will be pushed\n\t*/\n\tfindAllHosts(property, root) {\n\t\tlet hosts = this.stack.filter(function(level) {\n\t\t\treturn property in level;\n\t\t});\n\n\t\tif(hosts.length == 0 && root === true) {\n\t\t\thosts.push(this.stack[0]);\n\t\t}\n\n\t\treturn hosts;\n\t}\n};\n\nconst factory = target.factory = proxyFactory([traps, proxyRead], target);\n\nObject.freeze(traps);\n\nexport {\n\tfactory as default,\n\ttarget,\n\ttraps\n}\n","import proxyFactory from './factory.js';\nimport proxyReadDeep from './read-deep.js';\nimport { traps as writeTraps } from './write.js';\n\nconst traps = {};\nconst target = {};\n\nconst factory = target.factory = proxyFactory([traps, writeTraps, proxyReadDeep], target);\n\nObject.freeze(traps);\n\nexport {\n\tfactory as default,\n\ttarget,\n\ttraps\n}\n"]}